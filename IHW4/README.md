# ИДЗ #3
## **Калашников Егор Игоревич БПИ226**

### **Вариант:** 26

### **Работа выполнена на 8 баллов**

**Условие:** Задача об инвентаризации по книгам. После нового года в библиотеке университета обнаружилась пропажа каталога. После поиска и наказания, виноватых ректор дал указание восстановить каталог силами студентов. Фонд библиотека представляет собой прямоугольное помещение, в котором находится M рядов по N шкафов по K книг в каждом шкафу.

## Решение на 4-5 баллов.
### Алгоритмы и структуры данных:
- Структура `Book`.  В ней содержится информация о книге: ее id, номер ряда, номер шкафа и номер позиции в шкафу. Так же есть два булевых(интовых тк С а не С++) статуса, один показывает, есть ли книга, второй - проверена ли это книга. Передается сервером клиенту для проверки.
- Структура `Message`. В ней содержится поле - `id` книги и статус книги `taken` - результат проверки студентом. Передается на сервер клиентом как результат проверки.
- Книги генерируются в массив книг `library`, статус отвечающий за то, взята книга или находится на месте генерируется рандомно с вероятностью 50% что взята.

### Сценарий:
- Реализовано клиент–серверное приложение, в котором сервер (или серверы) и клиенты независимо друг от друга отображают только ту информацию, которая поступает им во время обмена.
- Приложение разработано таким образом, чтобы сервер и клиенты могли работать на разных компьютерах в сети, обеспечивая распределенную обработку данных.
- Для корректного взаимодействия сервер и клиенты используют сокеты и протокол UDP.
- Сервер - это библиотека, которая хранит массив книг проверяет, что все книги проверены и выдает книги на проверку.
- Клиент - это студент, который запрашивает книгу для проверки, после ее обработки формирует сообщение для каталога, отправляет ее на сервер.
- После запуска сервера, генерируется библиотека. Затем сервер ждет подключения клиента. Порт 8080.
- Обмен между клиентом и сервером происходит до тех пор, пока все книги не будут проверены.
- Если книга уже проверена, студент все равно ее проверят, но на экран выводится сообщение, что книга уже проверена.

### [Ссылка на скриншоты](screenshots)

### Инструкция по запуску:
1) В терминале линукс перейти в каталог с .cpp файлами;
2) Компиляция: прописать `gcc server.c -o server` и `gcc client.c -o client`;
3) Запуск: прописать сначала `./server`, и после, в другом окне терминала прописать `./client`;

## Решение на 6-7-8 баллов(решение на 6-7 модифицировал на 8 сразу).

### Изменения:
1) В структуре `Message` появилось новое поле - text - в котором хранится сообщение для каталога.
2) Создано новое клиентское приложение - `catalogue.cpp`. Теперь, в сервере есть массив клиентов, при подключении нового клиента, он попадает в массив. При обработке клиента сервер проверяет, что клиент является студентом, отправляет ему книгу на проверку, и получает результат проверки `Message msg`. Далее формируется сообщение в поле `text`, и `msg` отправляется клиенту-каталогу. Итого, все информация отображается в окне каталога.
3) Для этого была создана новая структура - `Client`, в котором хранится id сокета.
4) В структуру `Client` добавил поле id для студента, чтобы в каталоге было видно, кто выполняет проверку.
5) Благодаря мьютексам два студента не могут проверять одну книгу одновременно. Алгоритм генерации выбора книги был улучшен (тк rand() привязан ко времени).
6) В сообщениях каталога теперь пишутся id студентов, которые выполняли проверку, чтобы было видно, что несколько студентов проверяют библиотеку одновременно.

### Инструкция по запуску:
1) 1-2 шага одинаковые, только еще скомпилировать файл `catalogue.cpp`.
2) **ВАЖНО**: сначала запустить сервер, потом запустить клиент-каталог, а после уже запустить клиент-студента. Иначе будет `Segmentation fault`(тк в массиве клиентов под 0 индексом лежит каталог).
3) После запуска первого клиента, в другом окне можно запускать еще клиентов, у них появится свой id и они будут работать вместе.
